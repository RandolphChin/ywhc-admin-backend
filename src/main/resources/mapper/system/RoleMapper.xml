<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ywhc.admin.modules.system.role.mapper.RoleMapper">

    <!-- 根据角色标识查询角色 -->
    <select id="selectByRoleKey" resultType="com.ywhc.admin.modules.system.role.entity.SysRole">
        SELECT * FROM sys_role 
        WHERE role_key = #{roleKey} AND deleted = 0
    </select>

    <!-- 根据用户ID查询角色列表 -->
    <select id="selectRolesByUserId" resultType="com.ywhc.admin.modules.system.role.entity.SysRole">
        SELECT r.* FROM sys_role r
        LEFT JOIN sys_user_role ur ON r.id = ur.role_id
        WHERE ur.user_id = #{userId} 
          AND r.deleted = 0 
          AND r.status = 1
        ORDER BY r.sort_order ASC
    </select>

    <!-- 检查角色标识是否存在 -->
    <select id="existsByRoleKey" resultType="boolean">
        SELECT COUNT(1) > 0 FROM sys_role 
        WHERE role_key = #{roleKey} AND deleted = 0
    </select>

    <!-- 检查角色名称是否存在 -->
    <select id="existsByRoleName" resultType="boolean">
        SELECT COUNT(1) > 0 FROM sys_role 
        WHERE role_name = #{roleName} AND deleted = 0
    </select>

    <!-- 检查角色下是否有用户 -->
    <select id="hasUsers" resultType="boolean">
        SELECT COUNT(1) > 0 FROM sys_user_role 
        WHERE role_id = #{roleId}
    </select>

    <!-- 获取角色的菜单ID列表 -->
    <select id="selectMenuIdsByRoleId" resultType="long">
        SELECT menu_id FROM sys_role_menu 
        WHERE role_id = #{roleId}
    </select>

</mapper>
